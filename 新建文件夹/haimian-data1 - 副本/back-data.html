<!DOCTYPE html>
<html class="no-js" lang="">

<head>

    <meta charset="utf-8">
    <meta name="description" content="Flat, Clean, Responsive, admin template built with bootstrap 3">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <title>Cameo | Responsive Admin Dashboard</title>

    <script type="text/javascript">
    </script>
    <link rel="stylesheet" href="vendor/offline/theme.css">
    <link rel="stylesheet" href="vendor/pace/theme.css">


    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link href="css/bootstrap-table.css" rel="stylesheet">
    <link rel="stylesheet" href="css/panel.css">

    <link rel="stylesheet" href="css/skins/palette.1.css" id="skin">
    <link rel="stylesheet" href="css/fonts/style.1.css" id="font">
    <link rel="stylesheet" href="css/main.css">


    <script src="vendor/modernizr.js"></script>
    <script type="text/javascript">
    </script>
</head>

<body>

<div class="app" data-sidebar="locked">

    <header class="header header-fixed navbar box-shadow">
        <!-- <div class="brand">
            <a href="javascript:;" class="fa fa-bars off-left visible-xs" data-toggle="off-canvas" data-move="ltr"></a>
            <a href="javascript:;" class="fa fa-align-right off-right visible-xs" data-toggle="off-canvas" data-move="rtl"></a>
            <a href="index.html" class="navbar-brand">
                <i class="fa fa-stop mg-r-sm"></i>
                <span class="heading-font">
Cameo<b>ADMIN</b>
</span>
            </a>
        </div> -->
        <div class="brands">
            海绵大数据系统
        </div>

        <ul class="nav navbar-nav navbar-right hidden-xs">

            <!-- 消息 -->
            <li class="notifications dropdown hidden-xs">
                <a href="javascript:;" data-toggle="dropdown">
                    <i class="fa fa-bell"></i>
                    <div class="badge badge-top bg-danger animated flash" id="newStudent"></div>
                </a>
                <div class="dropdown-menu dropdown-menu-right animated slideInRight">
                    <div class="panel bg-white no-border no-margin">
                        <div class="panel-heading no-radius">
                            <small>
                                <b>更新</b>
                            </small>
                            <small class="pull-right">
                                <a href="javascript:;" class="mg-r-xs">标记已读</a>&#8226;
                                <a href="javascript:;" class="fa fa-cog mg-l-xs"></a>
                            </small>
                        </div>
                        <ul class="list-group">
                            <li class="list-group-item">
                                <a href="javascript:;">
                                        <span class="pull-left mg-t-xs mg-r-md">
                                            <img src="img/face4.jpg" class="avatar avatar-sm img-circle" alt="">
                                        </span>
                                    <div class="m-body show pd-t-xs">
                                        <a href="baoming.html">
                                            <span class="newStudentBm"></span>
                                            <span>赶快去查看吧</span>
                                            <small class="newStudentSmall"></small>
                                        </a>
                                    </div>
                                </a>
                            </li>
                            <!--<li class="list-group-item">-->
                                <!--<a href="javascript:;">-->
                                        <!--<span class="pull-left mg-t-xs mg-r-md">-->
                                            <!--<span class="fa-stack fa-lg">-->
                                                <!--<i class="fa fa-circle fa-stack-2x text-warning"></i>-->
                                                <!--<i class="fa fa-download fa-stack-1x fa-inverse"></i>-->
                                            <!--</span>-->
                                        <!--</span>-->
                                    <!--<div class="m-body show pd-t-xs">-->
                                        <!--<span>下载大小145MB.</span>-->
                                        <!--<div class="progress progress-xs mg-t-xs mg-b-xs">-->
                                            <!--<div class="progress-bar progress-bar-primary" role="progressbar"-->
                                                 <!--aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"-->
                                                 <!--style="width: 40%">-->
                                            <!--</div>-->
                                        <!--</div>-->
                                        <!--<small>发布于23分钟前</small>-->
                                    <!--</div>-->
                                <!--</a>-->
                            <!--</li>-->
                            <!--<li class="list-group-item">-->
                                <!--<a href="javascript:;">-->
                                        <!--<span class="pull-left mg-t-xs mg-r-md">-->
                                            <!--<img src="img/face3.jpg" class="avatar avatar-sm img-circle" alt="">-->
                                        <!--</span>-->
                                    <!--<div class="m-body show pd-t-xs">-->
                                        <!--<span>应用</span>-->
                                        <!--<span>我的工作去区控件在哪</span>-->
                                        <!--<small>5天前</small>-->
                                    <!--</div>-->
                                <!--</a>-->
                            <!--</li>-->
                        </ul>
                        <!--<div class="panel-footer no-border">-->
                            <!--<a href="javascript:;">查看所有更新</a>-->
                        <!--</div>-->
                    </div>
                </div>
            </li>

            <!-- 用户 -->
            <li class="quickmenu">
                <a href="javascript:;" data-toggle="dropdown">
                        <span class="avatar pull-left img-circle" style="display:block;width: 50px;line-height: 30px;
                        ">管理员</span>
                    <i class="caret mg-l-xs hidden-xs no-margin"></i>
                </a>
                <ul class="dropdown-menu dropdown-menu-right mg-r-xs">
                    <li>
                        <a href="javascript:;">
                            <div class="pd-t-sm">
                                gerald@morris.com
                                <br>
                                <small class="text-muted">4.2 MB of 51.25 GB used</small>
                            </div>
                            <div class="progress progress-xs no-radius no-margin mg-b-sm">
                                <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40"
                                     aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a href="###">设置</a>
                    </li>
                    <li>
                        <a href="javascript:;">更新</a>
                    </li>
                    <li>
                        <a href="javascript:;">消息通知
                            <div class="badge bg-danger pull-right">3</div>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:;">帮助 ?</a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="signin.html">退出登录</a>
                    </li>
                </ul>
            </li>
        </ul>
    </header>

    <section class="layout">

        <aside class="sidebar canvas-left" style="background:#000">

            <nav class="main-navigation">
                <ul>
                    <li class="">
                        <a onclick="window.location = './kehu.html'" data-toggle="dropdown">
                            <!-- <i class="fa fa-coffee"></i> -->
                            <span>推送数据</span>
                        </a>
                    </li>
                    <li class="dropdown show-on-hover active">
                        <a onclick="window.location = './back-data.html'" href="###" data-toggle="dropdown">
                            <!-- <i class="fa fa-ellipsis-h"></i> -->
                            <span>回收数据</span>
                        </a>

                    </li>
                    <li class="dropdown show-on-hover">
                        <a onclick="window.location = './mail.html'" href="###" data-toggle="dropdown">
                            <!-- <i class="fa fa-tasks"></i> -->
                            <span>海绵数据</span>
                        </a>

                    </li>
                    <li class="">
                        <a onclick="window.location = './baoming.html'" href="###" data-toggle="dropdown">
                            <!-- <div class="badge bg-none pull-right">8</div> -->
                            <!-- <i class="fa fa-envelope"></i> -->
                            <span>美术饭报名</span>
                        </a>
                    </li>
                    <li class="dropdown show-on-hover">
                        <a href="javascript:;" data-toggle="dropdown">
                            <!-- <i class="fa fa-file"></i> -->
                            <span>统计报告</span>
                        </a>

                </ul>
            </nav>


        </aside>


        <aside class="sidebar-250 canvas-right bg-white bd-t">

            <div class="content-wrap no-padding">
                <nav role="navigation">
                    <div class="no-padding">
                        <input type="text" placeholder="搜索地区" class="nav_search_huashi">
                        <!-- <div class="nav_all_data">全部<span class="badge pull-right bg-danger">896</span></div> -->
                        <ul class="nav nav-pills nav-stacked">
                        </ul>
                    </div>
                </nav>
            </div>
        </aside>
        <section class="main-content">
            <ul class="main-content-top main-content-all">
                <li class="main-content-active"><a href="javascript:;">回收数据
</a></li>

            </ul>
            <ul class="main-content-all main-content-center">
                <!-- <li><a href="javascript:;">导出数据</a></li> -->
                <li><a href="" id="pldc">批量导出</a></li>
                <li><a href="http://www.haimian.com/api/exportData?cityid = 0" id="qbdc">全部导出</a></li>
            </ul>
            <div class="data_table main-content-all">
                <table id="table"></table>
            </div>

        </section>


    </section>
</div>

<script src="vendor/jquery-1.11.1.min.js"></script>
<script src="bootstrap/js/bootstrap.js"></script>
<script src="vendor/jquery.easing.min.js"></script>
<script src="vendor/jquery.placeholder.js"></script>
<script src="vendor/fastclick.js"></script>
<!-- <script src="js/layer.js"></script> -->

<script src="vendor/offline/offline.min.js"></script>
<script src="vendor/pace/pace.min.js"></script>
<script src="js/bootstrap-table.js"></script>
<script src="js/bootstrap-table-zh-CN.js"></script>
<script src="js/bootstrap-paginator.js"></script>
<script src="js/off-canvas.js"></script>
<script src="js/main.js"></script>
<script src="js/panel.js"></script>
<script type="text/javascript">
    let city = '';
    var datas = [];
    $.ajax({
        url: 'http://www.haimian.com/api/getcity',
        dataType: 'JSON',
        type: 'POST',
        data: {
            "city": city
        },
        success: function(res) {
            let data = res.data.data;
            let $html = `<li class="nav-active" data-id=''>
                                    <a href="javascript:;">全部
                                                <span class="badge pull-right bg-danger">${res.data.nums}</span>
                                            </a>
                                </li>`;
            $.each(data, function(index, item) {
                $html += `<li data-id='${item.id}'>
                                    <a href="javascript:;">${item.city}
                                        <span class="badge pull-right bg-default">${item.count}</span>
                                    </a>
                                </li>`
                $('.nav-stacked').html($html)
            })
        }
    })
    $.ajax({
        url: 'http://www.haimian.com/api/getstudent',
        dataType: 'JSON',
        type: 'POST',
        data: {
            "cityid": city
        },
        success: function (res) {
            let data = res.data;
            $("#table").bootstrapTable({ // 对应table标签的id
                // url: "<%=request.getContextPath()%>/api/getDataList.do", // 获取表格数据的url
                // cache: false, // 设置为 false 禁用 AJAX 数据缓存， 默认为true
                // striped: true, //表格显示条纹，默认为false
                pagination: true, // 在表格底部显示分页组件，默认false
                //search: true,
                //detailView: true, //父子表
                striped: true,
                pageList: [10, 20, 30], // 设置页面可以显示的数据条数
                pageSize: 10, // 页面数据条数
                //sidePagination: "client", //server
                // clickToSelect: true, //是否启用点击选中行
                pageNumber: 1, // 首页页码

                columns: [{
                    checkbox: true, // 显示一个勾选框
                    align: 'center',
                    valign: 'middle', // 居中显示

                }, {
                    field: 'user_number', // 返回json数据中的name
                    title: '编号', // 表格表头显示文字
                    align: 'center', // 左右居中
                    valign: 'middle' // 上下居中
                }, {
                    field: 'name',
                    title: '省份',
                    align: 'center',
                    valign: 'middle'
                }, {
                    field: 'phone',
                    title: '联系号码',
                    align: 'center',
                    valign: 'middle',

                }, {
                    field: 'updated_at',
                    title: '回收时间',
                    align: 'center',
                    valign: 'middle',
                },

                    {
                        title: "操作",
                        align: 'center',
                        valign: 'middle',
                        width: 160, // 定义列的宽度，单位为像素px
                        formatter: function (value, row, index) {
                            return '<button class="fenpei btn btn-primary" id="fenpei">推送</button>' + '<button class="delete  btn" id="delete">删除</button>';
                        },
                        events: {
                            'click #fenpei': function (e, value, row, index) {
                                console.log(index)
                                // layer.open({
                                //     type: 1,
                                //     skin: 'layui-layer-rim', //加上边框
                                //     area: ['420px', '240px'], //宽高
                                //     content: 'html内容'
                                // });
                            }
                        }
                    }
                ],
                data: data,
                onLoadSuccess: function () { //加载成功时执行
                    console.info("加载成功");
                },
                onLoadError: function () { //加载失败时执行
                    console.info("加载数据失败");
                },
                onCheck: function (row) {
                    datas.push(row.id);
                    let url = "http://www.haimian.com/api/export?date = " + datas
                    $("#pldc").attr("href",url);
                },
                onCheckAll: function (row) {
                    for (var i=0;i<row.length;i++){
                        datas.push(row[i].id)
                    }
                    let url = "http://www.haimian.com/api/export?date = " + datas
                    $("#pldc").attr("href",url);
                },
                onUncheck: function (row) {
                    datas.splice($.inArray(row.id,datas),1)
                    console.log(datas)
                },
                onUncheckAll:function (row) {
                    datas = []
                }
            })
            // $('#table').on("click-row.bs.table", function(a, b, c) {
            //     console.log(b)
            // })
            $('.nav-pills li').click(function () {
                $(this).addClass('nav-active').siblings('.nav-active').removeClass('nav-active')
            })
            $('.main-content-top li').click(function () {
                $(this).addClass('main-content-active').siblings().removeClass('main-content-active')
            })
        }
    })

    $.ajax({
        url: 'http://www.haimian.com/api/getStudentNo',
        dataType: 'JSON',
        type: 'get',
        success:function (res) {
            if (res.data[0].count != 0){
                $(".newStudentBm").html("你有"+res.data[0].count + "个新的报名数据")
                $(".newStudentSmall").html(res.data.date)
                $("#newStudent").html(1)
            }
        }
    })
    // $(".pldc").click(function () {
    //
    //     $.ajax({
    //         url: 'http://www.haimian.com/api/dc',
    //         dataType: 'JSON',
    //         type: 'get',
    //         // data:{
    //         //     date:datas
    //         // } ,
    //         success:function (res) {
    //
    //         }
    //     })
    //
    // })
    $(document).on("click", ".nav-pills li", function() {
        let id = $(this).attr('data-id');
        let urls = "http://www.haimian.com/api/exportData?cityid = " + id
        $("#qbdc").attr("href",urls);
        $(this).addClass('nav-active').siblings('.nav-active').removeClass('nav-active')
        // console.log(id)
        $.ajax({
            url: 'http://www.haimian.com/api/getstudent',
            dataType: 'JSON',
            type: 'POST',
            data: {
                "cityid": id
            },
            success: function(res) {
                let data = res.data
                let $htmls = ''
                if (data == '') {
                    $htmls = `<div style='background:#eee;width:100%;text-align:center;line-height:50px;font-size:16px'>暂无数据</div>`
                    $('.data_table').html($htmls)
                } else {
                    $('.data_table').html('<table id="table"></table>')
                  $("#table").bootstrapTable({ // 对应table标签的id
                        // url: "<%=request.getContextPath()%>/api/getDataList.do", // 获取表格数据的url
                        // cache: false, // 设置为 false 禁用 AJAX 数据缓存， 默认为true
                        // striped: true, //表格显示条纹，默认为false
                        pagination: true, // 在表格底部显示分页组件，默认false
                        //search: true,
                        //detailView: true, //父子表
                        striped: true,
                        pageList: [10, 20, 30], // 设置页面可以显示的数据条数
                        pageSize: 10, // 页面数据条数
                        //sidePagination: "client", //server
                        // clickToSelect: true, //是否启用点击选中行
                        pageNumber: 1, // 首页页码
                        columns: [{
                            checkbox: true, // 显示一个勾选框
                            align: 'center',
                            valign: 'middle', // 居中显示

                        }, {
                            field: 'user_number', // 返回json数据中的name
                            title: '编号', // 表格表头显示文字
                            align: 'center', // 左右居中
                            valign: 'middle' // 上下居中
                        }, {
                            field: 'name',
                            title: '省份',
                            align: 'center',
                            valign: 'middle'
                        }, {
                            field: 'phone',
                            title: '联系号码',
                            align: 'center',
                            valign: 'middle',

                        }, {
                            field: 'updated_at',
                            title: '回收时间',
                            align: 'center',
                            valign: 'middle',
                        },

                            {
                                title: "操作",
                                align: 'center',
                                valign: 'middle',
                                width: 160, // 定义列的宽度，单位为像素px
                                formatter: function (value, row, index) {
                                    return '<button class="fenpei btn btn-primary" id="fenpei">推送</button>' + '<button class="delete  btn" id="delete">删除</button>';
                                },
                                events: {
                                    'click #fenpei': function (e, value, row, index) {
                                        console.log(index)
                                        // layer.open({
                                        //     type: 1,
                                        //     skin: 'layui-layer-rim', //加上边框
                                        //     area: ['420px', '240px'], //宽高
                                        //     content: 'html内容'
                                        // });
                                    }
                                }
                            }
                        ],
                        data: data,
                        onLoadSuccess: function () { //加载成功时执行
                            console.info("加载成功");
                        },
                        onLoadError: function () { //加载失败时执行
                            console.info("加载数据失败");
                        },
                        onCheck: function (row) {
                            datas.push(row.id);
                            let url = "http://www.haimian.com/api/export?date = " + datas
                            $("#pldc").attr("href",url);
                            console.log(url)
                        },
                      onCheckAll: function (row) {
                          for (var i=0;i<row.length;i++){
                              datas.push(row[i].id)
                          }

                          console.log(datas)
                          let url = "http://www.haimian.com/api/export?date = " + datas
                          $("#pldc").attr("href",url);
                          console.log(url)
                      },
                      onUncheck: function (row) {
                          datas.splice($.inArray(row.id,datas),1)
                          console.log(datas)
                      },
                      onUncheckAll:function (row) {
                          datas = []
                      }
                    })

                    // $('#table').on("click-row.bs.table", function(a, b, c) {
                    //     console.log(b)
                    // })
                    $('.nav-pills li').click(function () {
                        $(this).addClass('nav-active').siblings('.nav-active').removeClass('nav-active')
                    })
                    $('.main-content-top li').click(function () {
                        $(this).addClass('main-content-active').siblings().removeClass('main-content-active')
                    })
                }

            }

            //console.log(data)
        })
    })
    $('.nav_search_huashi').on("change", function() {
        //console.log($('.nav_search_huashi').val())
        //let ctx = e.originalEvent.data
        let search = $('.nav_search_huashi').val()
        $.ajax({
            url: 'http://www.haimian.com/api/getcity',
            dataType: 'JSON',
            type: 'POST',
            data: {
                "city": search
            },
            success: function(res) {
                if (search == '') {
                    // console.log(res)
                    return false
                } else if (res.message == '没有此城市的学校信息' && search != '') {
                    alert('暂无该城市信息')
                } else if (res.message == "成功" && search != '') {
                    let $html = ''
                    let id = res.data[0].id
                    let data = res.data;
                    // let $html = `<li class="nav-active" data-id=''>
                    //                 <a href="javascript:;">全部
                    //                             <span class="badge pull-right bg-danger">${res.data.nums}</span>
                    //                         </a>
                    //             </li>`;
                    $.each(data, function(index, item) {
                        $html = `<li data-id='${item.id}'>
                                    <a href="javascript:;">${item.city}
                                        <span class="badge pull-right bg-default">${item.count}</span>
                                    </a>
                                </li>`
                        $('.nav-stacked').html($html)
                    })
}
                    // $.ajax({
                    //     url: 'http://www.haimian.com/api/getstudent',
                    //     dataType: 'JSON',
                    //     type: 'POST',
                    //     data: {
                    //         "cityid": id
                    //     },
                    //     success: function(res) {
                    //         let data = res.data
                    //         $('.data_table').html('<table id="table"></table>')
                    //         $("#table").bootstrapTable({ // 对应table标签的id
                    //             // url: "<%=request.getContextPath()%>/api/getDataList.do", // 获取表格数据的url
                    //             // cache: false, // 设置为 false 禁用 AJAX 数据缓存， 默认为true
                    //             // striped: true, //表格显示条纹，默认为false
                    //             pagination: true, // 在表格底部显示分页组件，默认false
                    //             //search: true,
                    //             //detailView: true, //父子表
                    //             striped: true,
                    //             pageList: [10, 20, 30], // 设置页面可以显示的数据条数
                    //             pageSize: 10, // 页面数据条数
                    //             //sidePagination: "client", //server
                    //             // clickToSelect: true, //是否启用点击选中行
                    //             pageNumber: 1, // 首页页码
                    //             columns: [{
                    //                 checkbox: true, // 显示一个勾选框
                    //                 align: 'center',
                    //                 valign: 'middle', // 居中显示
                    //
                    //             }, {
                    //                 field: 'user_number', // 返回json数据中的name
                    //                 title: '编号', // 表格表头显示文字
                    //                 align: 'center', // 左右居中
                    //                 valign: 'middle' // 上下居中
                    //             }, {
                    //                 field: 'name',
                    //                 title: '省份',
                    //                 align: 'center',
                    //                 valign: 'middle'
                    //             }, {
                    //                 field: 'phone',
                    //                 title: '联系号码',
                    //                 align: 'center',
                    //                 valign: 'middle',
                    //
                    //             }, {
                    //                 field: 'updated_at',
                    //                 title: '回收时间',
                    //                 align: 'center',
                    //                 valign: 'middle',
                    //             },
                    //
                    //                 {
                    //                     title: "操作",
                    //                     align: 'center',
                    //                     valign: 'middle',
                    //                     width: 160, // 定义列的宽度，单位为像素px
                    //                     formatter: function (value, row, index) {
                    //                         return '<button class="fenpei btn btn-primary" id="fenpei">分配</button>' + '<button class="delete  btn" id="delete">删除</button>';
                    //                     },
                    //                     events: {
                    //                         'click #fenpei': function (e, value, row, index) {
                    //                             console.log(index)
                    //                             // layer.open({
                    //                             //     type: 1,
                    //                             //     skin: 'layui-layer-rim', //加上边框
                    //                             //     area: ['420px', '240px'], //宽高
                    //                             //     content: 'html内容'
                    //                             // });
                    //                         }
                    //                     }
                    //                 }
                    //             ],
                    //             data: data,
                    //             onLoadSuccess: function () { //加载成功时执行
                    //                 console.info("加载成功");
                    //             },
                    //             onLoadError: function () { //加载失败时执行
                    //                 console.info("加载数据失败");
                    //             },
                    //             onCheck: function (row) {
                    //                 console.log("您选中的行的name为" + row.name + "，您选中的行的age为" + row.age + "，您选中的行的id为" + row.id);
                    //             }
                    //         })

                            // $('#table').on("click-row.bs.table", function(a, b, c) {
                            //     console.log(b)
                            // })
                            $('.nav-pills li').click(function () {
                                $(this).addClass('nav-active').siblings('.nav-active').removeClass('nav-active')
                            })
                            $('.main-content-top li').click(function () {
                                $(this).addClass('main-content-active').siblings().removeClass('main-content-active')
                            })

                        }
                    })

        })




</script>
</body>

</html>